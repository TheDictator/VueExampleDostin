'use strict';

var _gulp = require('gulp');

var _gulp2 = _interopRequireDefault(_gulp);

var _ = require('./../');

var _2 = _interopRequireDefault(_);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var batch = _2.default.Plugins.batch;
var $ = _2.default.Plugins;

/*
 |----------------------------------------------------------------
 | Watcher
 |----------------------------------------------------------------
 |
 | When you want to keep an eye on your files for changes, and
 | then re-trigger Gulp, then you should use the gulp watch
 | command. This way, you can auto-compile on each save!
 |
 */

_gulp2.default.task('watch', function () {
    initBrowserify();

    _2.default.hooks.watch.forEach(function (hook) {
        return hook();
    });

    _2.default.tasks.forEach(function (task) {
        var batchOptions = _2.default.config.batchOptions;

        if (task.hasWatchers()) {
            $.watch(task.watchers, batch(batchOptions, function (events) {
                events.on('end', _gulp2.default.start(task.name));
            }));
        }
    });
});

/**
 * Determine if Browserify is included in the list.
 */
function initBrowserify() {
    if (_2.default.tasks.has('browserify')) {
        _2.default.config.js.browserify.watchify.enabled = true;

        _gulp2.default.start('browserify');
    }
};