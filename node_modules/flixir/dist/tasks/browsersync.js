'use strict';

var _2 = require('./../');

var _3 = _interopRequireDefault(_2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var config = _3.default.config;
var _ = void 0;
var browserSync = void 0;

/*
 |----------------------------------------------------------------
 | BrowserSync
 |----------------------------------------------------------------
 |
 | Browsersync makes your browser testing workflow faster by
 | synchronizing URLs, behavior, and code changes across
 | across multiple devices. And, now it's in Flixir!
 |
 */

_3.default.extend('browserSync', function (options) {
    loadPlugins();

    options = _.extend({
        files: [config.appPath + '/**/*.php', config.get('public.css.outputFolder') + '/**/*.css', config.get('public.js.outputFolder') + '/**/*.js', config.get('public.versioning.buildFolder') + '/rev-manifest.json', config.viewPath + '/**/*.php'],
        watchOptions: {
            usePolling: true
        },
        snippetOptions: {
            rule: {
                match: /(<\/body>|<\/pre>)/i,
                fn: function fn(snippet, match) {
                    return snippet + match;
                }
            }
        }
    }, config.browserSync, options);

    // Browsersync will only run during `gulp watch`.
    if (_3.default.isWatching()) {
        browserSync.init(options);
    }

    new _3.default.Task('browserSync', function () {}).watch();
});

/**
 * Load the required Gulp plugins on demand.
 */
function loadPlugins() {
    _ = require('underscore');
    browserSync = require('browser-sync').create();
};